# üîß Firecrawl Token Usage Optimization

**–î–∞—Ç–∞:** 2025-01-XX  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ firecrawl (crawl –º–µ—Ç–æ–¥) - –æ—á–µ–Ω—å –º–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–æ  
**–†–µ—à–µ–Ω–∏–µ:** –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üêõ –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤ firecrawl –¥–ª—è –æ–¥–Ω–æ–≥–æ URL
**–ü—Ä–æ–±–ª–µ–º–∞:** –§—É–Ω–∫—Ü–∏—è `extractTreatmentConnectPrices` –≤—ã–∑—ã–≤–∞–ª–∞—Å—å –¥–≤–∞–∂–¥—ã –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ URL:
- –°–Ω–∞—á–∞–ª–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `costData` (—Å—Ç—Ä–æ–∫–∞ 658)
- –ü–æ—Ç–æ–º —Å–Ω–æ–≤–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `clinicData` (—Å—Ç—Ä–æ–∫–∞ 723)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–ª—è –∫–∞–∂–¥–æ–≥–æ URL –¥–µ–ª–∞–ª–æ—Å—å **2 –∑–∞–ø—Ä–æ—Å–∞** –∫ firecrawl –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ.

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ URL –º–æ–≥ –ø–∞—Ä—Å–∏—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –∫–æ–¥–∞ –±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ URL —É–≤–µ–ª–∏—á–∏–≤–∞–ª–∏ —Ä–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤.

### 3. –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ —Å–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–ª costData, –∞ –ø–æ—Ç–æ–º –æ—Ç–¥–µ–ª—å–Ω–æ –ø–æ–ª—É—á–∞–ª clinicData –∏–∑ —Ç–µ—Ö –∂–µ URL.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–≤–æ–π–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ –¥–∞–Ω–Ω—ã—Ö.

---

## ‚úÖ –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
```javascript
// Cache for firecrawl requests to avoid duplicate calls
const firecrawlCache = new Map();

async function scrapeWithJSONMode(url, schema, prompt, maxRetries = 2) {
  // Create cache key from URL + schema
  const cacheKey = `${url}::${JSON.stringify(schema)}`;
  
  // Check cache first
  if (firecrawlCache.has(cacheKey)) {
    console.log(`  üíæ Using cached result for ${url}`);
    return firecrawlCache.get(cacheKey);
  }
  
  // ... make request ...
  
  // Cache successful result
  firecrawlCache.set(cacheKey, jsonData);
  return jsonData;
}
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –æ–¥–Ω–æ–º—É –∏ —Ç–æ–º—É –∂–µ URL —Å —Ç–æ–π –∂–µ —Å—Ö–µ–º–æ–π –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ firecrawl.

### 2. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è costData –∏ clinicData
**–î–æ:**
```javascript
// –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º costData
costData = await extractTreatmentConnectPrices(url, procedure, city);

// –ü–æ—Ç–æ–º —Å–Ω–æ–≤–∞ –ø–æ–ª—É—á–∞–µ–º —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è clinicData
const costData = await extractTreatmentConnectPrices(url, procedure, city);
```

**–ü–æ—Å–ª–µ:**
```javascript
// –û–¥–∏–Ω –≤—ã–∑–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
const extractedData = await extractTreatmentConnectPrices(url, procedure, city);

// –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è costData –∏ clinicData
if (!costData) {
  costData = extractedData;
}
// –°–æ–∑–¥–∞–µ–º clinic entry –∏–∑ —Ç–µ—Ö –∂–µ –¥–∞–Ω–Ω—ã—Ö
if (extractedData.hospital_name && extractedData.url) {
  // ... create clinic entry ...
}
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ firecrawl –≤ **2 —Ä–∞–∑–∞** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ URL.

### 3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ hospital details
**–î–æ:** –í full mode –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–Ω–∏–∫–∞ –¥–µ–ª–∞–ª—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –±–æ–ª—å–Ω–∏—Ü—ã.

**–ü–æ—Å–ª–µ:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `scrapeWithJSONMode` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ URL –±–æ–ª—å–Ω–∏—Ü.

**–≠—Ñ—Ñ–µ–∫—Ç:** –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–¥—É—Ä –≤ –æ–¥–Ω–æ–π –±–æ–ª—å–Ω–∏—Ü–µ, –¥–µ—Ç–∞–ª–∏ –±–æ–ª—å–Ω–∏—Ü—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑.

---

## üìä –û–∂–∏–¥–∞–µ–º–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **15 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π** (3 –ø—Ä–æ—Ü–µ–¥—É—Ä—ã √ó 5 –≥–æ—Ä–æ–¥–æ–≤)
- **~5-10 URL –Ω–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é** (TreatmentConnect URLs)
- **2 –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ URL** (costData + clinicData)
- **–ò—Ç–æ–≥–æ:** ~150-300 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ firecrawl

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **15 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π** (3 –ø—Ä–æ—Ü–µ–¥—É—Ä—ã √ó 5 –≥–æ—Ä–æ–¥–æ–≤)
- **~5-10 URL –Ω–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é** (TreatmentConnect URLs)
- **1 –∑–∞–ø—Ä–æ—Å –Ω–∞ URL** (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π costData + clinicData)
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- **–ò—Ç–æ–≥–æ:** ~75-150 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ firecrawl (—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ **50%**)

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è:
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ URL
- –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–¥—É—Ä –≤ –æ–¥–Ω–æ–π –±–æ–ª—å–Ω–∏—Ü–µ, –¥–µ—Ç–∞–ª–∏ –±–æ–ª—å–Ω–∏—Ü—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
- **–ò—Ç–æ–≥–æ:** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ **10-20%**

---

## üéØ –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤

**–û–∂–∏–¥–∞–µ–º–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ:** **60-70%** –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ä–∞—Å—Ö–æ–¥–∞ —Ç–æ–∫–µ–Ω–æ–≤

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fast mode –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**
   - Fast mode –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ü–µ–Ω—ã, –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—è –¥–µ—Ç–∞–ª–∏ –±–æ–ª—å–Ω–∏—Ü
   - Full mode –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–ª–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
   - –ù–µ –æ–±–Ω–æ–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–µ–¥–∞–≤–Ω–æ
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å

3. **–ë–∞—Ç—á–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤**
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ –¥–æ–º–µ–Ω–∞–º
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å rate limiting –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ

4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤**
   - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ firecrawl
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º:
   ```bash
   node scripts/scraper.js --mode=fast 2>&1 | grep -E "(Using cached|Attempt|firecrawl)"
   ```

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤:
   - –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: ~150-300 –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: ~50-100 –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å —É—á–µ—Ç–æ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è)

3. –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤ –≤ dashboard firecrawl

---

## üìå –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- **–ö—ç—à –∂–∏–≤–µ—Ç —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞** - –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏
- **–ö—ç—à –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ URL + schema** - —Ä–∞–∑–Ω—ã–µ —Å—Ö–µ–º—ã –¥–ª—è –æ–¥–Ω–æ–≥–æ URL = —Ä–∞–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (—ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- **–ö—ç—à –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è** - –µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ–ª–≥–æ, –∫—ç—à –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –ø–∞–º—è—Ç—å (–Ω–æ —ç—Ç–æ –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞ –¥–ª—è —Ç–∏–ø–∏—á–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤)

