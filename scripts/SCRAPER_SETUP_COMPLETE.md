# ‚úÖ Firecrawl Automation Setup - Complete

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. ‚úÖ `scripts/config.js` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ø—Ä–æ—Ü–µ–¥—É—Ä—ã, –≥–æ—Ä–æ–¥–∞, NHS trusts, –≤–∞–ª–∏–¥–∞—Ü–∏—è)
2. ‚úÖ `scripts/utils.js` - –£—Ç–∏–ª–∏—Ç—ã (CSV —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö)
3. ‚úÖ `scripts/scraper.js` - –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —Å–∫—Ä–∞–ø–∏–Ω–≥–∞ —Å fallback –ª–æ–≥–∏–∫–æ–π
4. ‚úÖ `scripts/schemas/` - JSON —Å—Ö–µ–º—ã –¥–ª—è Firecrawl JSON Mode (LLM Extract)
   - `nhs-waits-schema.js` - –°—Ö–µ–º–∞ –¥–ª—è NHS waiting times
   - `private-costs-schema.js` - –°—Ö–µ–º–∞ –¥–ª—è private costs
   - `clinics-schema.js` - –°—Ö–µ–º–∞ –¥–ª—è clinic details
   - `index.js` - –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —Å—Ö–µ–º
5. ‚úÖ `.github/workflows/weekly-data-update.yml` - GitHub Actions workflow
6. ‚úÖ `scripts/test-json-mode.js` - –¢–µ—Å—Ç—ã –¥–ª—è JSON Mode –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
7. ‚úÖ `scripts/test-fallback.js` - –¢–µ—Å—Ç—ã fallback –ª–æ–≥–∏–∫–∏
8. ‚úÖ `scripts/test-fallback-extended.js` - –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã fallback

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `"type": "module"` –≤ `package.json` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ ES modules
- ‚úÖ Firecrawl SDK —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (`firecrawl@4.5.0`)
- ‚úÖ API Key –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π)

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### JSON Mode (LLM Extract) - –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Firecrawl v2 API —Å JSON Mode –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –£—Å—Ç–æ–π—á–∏–≤ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–∞–π—Ç–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç LLM –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞)
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã JSON —Å—Ö–µ–º—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–æ–º–ø—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –Ω—É–∂–Ω—ã—Ö –ø–æ–ª–µ–π
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è NHS Waiting Times –∏ Clinic Details
- ‚ö†Ô∏è Private Costs —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0, –≤–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω—ã –¥—Ä—É–≥–∏–µ URL)

### Fallback –ª–æ–≥–∏–∫–∞ (—Ç—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è)
1. **JSON Mode** (–æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥) ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ LLM
2. **Regex Parser** (fallback 1) ‚Üí –ï—Å–ª–∏ JSON Mode –Ω–µ –≤–µ—Ä–Ω—É–ª –¥–∞–Ω–Ω—ã–µ
3. **CSV Fallback** (fallback 2) ‚Üí –ï—Å–ª–∏ –æ–±–∞ –º–µ—Ç–æ–¥–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏
   - –ß–∏—Ç–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ —É—Å–ø–µ—à–Ω—ã–µ CSV –∏–∑ `public/data/`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞—Ç—É –≤ fallback –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Ç–µ–∫—É—â—É—é
   - –õ–æ–≥–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ fallback –¥–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
   - –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ `procedure_id` –∏ `city`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ Retry –ª–æ–≥–∏–∫–∞ (–¥–æ 2 –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞)
- ‚úÖ Rate limiting (6 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é
- ‚úÖ –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (–Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç)
- ‚úÖ Graceful degradation: JSON Mode ‚Üí Regex ‚Üí CSV

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ NHS waits: `procedure_id, city, nhs_trust, avg_wait_weeks, date, source`
- ‚úÖ Private costs: `procedure_id, city, cost_min, cost_max, clinic_count, date, source`
- ‚úÖ Clinics: `clinic_id, name, city, procedure_id, price, url, phone, last_updated`

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
```bash
export FIRECRAWL_API_KEY=fc-864a2c592f884561aa6887041fafcaf8
node scripts/scraper.js
```

### 2. –î–æ–±–∞–≤–∏—Ç—å GitHub Secret
```
GitHub ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions
‚Üí New secret: FIRECRAWL_API_KEY = fc-864a2c592f884561aa6887041fafcaf8
```

### 3. –ö–æ–º–º–∏—Ç –∏ push
```bash
git add scripts/ .github/ package.json
git commit -m "Setup Firecrawl automation with fallback logic"
git push origin main
```

### 4. –¢–µ—Å—Ç GitHub Actions
```
GitHub ‚Üí Actions ‚Üí "Weekly Data Update" ‚Üí Run workflow
```

## üìä –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫:** –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 9:00 AM GMT
- **–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫:** –ß–µ—Ä–µ–∑ GitHub Actions UI (workflow_dispatch)

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **JSON Mode** - –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è, —É—Å—Ç–æ–π—á–∏–≤ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–∞–π—Ç–æ–≤
2. **My Planned Care** –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 503 - –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback
3. **PHIN Costs** - JSON Mode —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 (–≤–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω—ã –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ URL)
4. **Fallback —Ü–µ–ø–æ—á–∫–∞** –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã:
   - JSON Mode ‚Üí Regex Parser ‚Üí CSV Fallback
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –º–µ—Ç–æ–¥—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ:
- ‚úÖ GitHub Actions workflow —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è
- ‚úÖ CSV —Ñ–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∞—Ç–æ–π
- ‚úÖ –î–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã (–ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `scripts/validate_data.js`)
- ‚úÖ Website –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSON Mode (LLM Extract) –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
- –¢—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è fallback —Å–∏—Å—Ç–µ–º–∞: JSON Mode ‚Üí Regex ‚Üí CSV
- –ï—Å–ª–∏ —Å–∞–π—Ç—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —É—Å–ø–µ—à–Ω—ã—Ö CSV
- –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Ç–µ–∫—É—â—É—é –¥–∞–∂–µ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ fallback
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é
- –¢–µ—Å—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã: `test-json-mode.js`, `test-fallback.js`, `test-fallback-extended.js`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
# –¢–µ—Å—Ç JSON Mode –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
export FIRECRAWL_API_KEY=fc-864a2c592f884561aa6887041fafcaf8
node scripts/test-json-mode.js

# –¢–µ—Å—Ç fallback –ª–æ–≥–∏–∫–∏
node scripts/test-fallback.js

# –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã fallback
node scripts/test-fallback-extended.js
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ NHS Waiting Times: JSON Mode —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ö†Ô∏è Private Costs: JSON Mode —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 (—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏)
- ‚úÖ Clinic Details: JSON Mode —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Fallback –ª–æ–≥–∏–∫–∞: –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç

